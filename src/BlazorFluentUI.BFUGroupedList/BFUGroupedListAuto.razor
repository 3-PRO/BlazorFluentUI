@namespace BlazorFluentUI
@inherits BFUComponentBase
@typeparam TItem
@typeparam TKey

@if (groupedUIListItems != null)
{
    <BFUList TItem="IGroupedListItem3<TItem>"
             @ref="listReference"
             ClassName=@($"ms-GroupedList{(string.IsNullOrEmpty(ClassName) ? "" : " " + ClassName)}")
             IsVirtualizing=@IsVirtualizing
             ItemsSource=@groupedUIListItems
             StartIndex=0
             >
        <ItemTemplate>
            @if (context.Item is HeaderItem3<TItem,TKey>)
            {
                var header = context.Item as HeaderItem3<TItem,TKey>;
               
                <BFUGroupHeader IsOpen=@header.IsOpen
                                OnOpenChanged=@((isOpen)=>header.IsOpen = isOpen)
                                Count=@header.Count
                                GroupLevel=@header.Depth
                                Name=@header.Name
                                Compact=@Compact
                                
                                IsSelectionCheckVisible=@(SelectionZone != null)
                                OnClick=@(()=>OnHeaderClicked(context))
                                OnToggle=@(()=>OnHeaderToggled(context)) />
                @if (header.IsOpen)
                {
                    <BFUGroupItem ItemsSource=@header.Items
                                  TItem=@TItem
                                  TKey=@TKey
                                  GetKey=@GetKey
                                  IsVirtualizing=@IsVirtualizing
                                  Compact=@Compact
                                  ItemTemplate=@ItemTemplate
                                  SelectionMode=@SelectionMode
                                  Selection=@Selection
                                  StartIndex=@header.GroupIndex
                                  />

                }
            }
            else
            {
                @if (context.Item.IsVisible)
                {
                    @ItemTemplate(context)
                }
            }
        </ItemTemplate>
    </BFUList>

}